<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=/posts/smtp-sendmail/><meta name=description content="Communicate with an SMTP server to send emails ðŸ“§"><meta name=language content="en"><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><title>Sending mail using SMTP protocol :: &lt;stdin></title><link rel=icon type=image/png href=/static/chip.png><meta property="og:title" content="Sending mail using SMTP protocol"><meta property="og:description" content="Communicate with an SMTP server to send emails ðŸ“§"><meta property="og:type" content="article"><meta property="og:url" content="/posts/smtp-sendmail/"><meta property="og:image" content="https://i.imgur.com/PHC1msC.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-17T00:47:17+05:30"><meta property="article:modified_time" content="2020-09-17T00:47:17+05:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.imgur.com/PHC1msC.jpg"><meta name=twitter:title content="Sending mail using SMTP protocol"><meta name=twitter:description content="Communicate with an SMTP server to send emails ðŸ“§"><meta name=theme-color content="#2e2847"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel=stylesheet><script src=/js/main.min.f8a31813e8097da432d631743cdb3eb23254823b561107d20d1e7c7ff648b1adbfdce37b9c6846505abf6476d90b9a5e0b26356dc195e8416276eb962c21dc23.js integrity="sha512-+KMYE+gJfaQy1jF0PNs+sjJUgjtWEQfSDR58f/ZIsa2/3ON7nGhGUFq/ZHbZC5peCyY1bcGV6EFiduuWLCHcIw=="></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css integrity="sha512-8jdwayz5n8F2cnW26l9vpV6+yGOcRAqz6HTu+DQ3FtVIAts2gTdlFZOGpYhvBMXkWEgxPN3Y22UWyZXuDowNLA==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/regular.min.css integrity="sha512-qgtcTTDJDk6Fs9eNeN1tnuQwYjhnrJ8wdTVxJpUTkeafKKP6vprqRx5Sj/rB7Q57hoYDbZdtHR4krNZ/11zONg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/brands.min.css integrity="sha512-AMDXrE+qaoUHsd0DXQJr5dL4m5xmpkGLxXZQik2TvR2VCVKT/XRPQ4e/LTnwl84mCv+eFm92UG6ErWDtGM/Q5Q==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/solid.min.css integrity="sha512-QN7X/bUbbeel9bbq6JVNJXk1Zowt+n+QPN+DjhEmTa4TdL1YPCsCey5JrvfRW8xp28LDYgGG/waNVdrhwMQmVQ==" crossorigin=anonymous><link rel=stylesheet type=text/css media=screen href=/css/main.min.48edec8e71e3c4241e1b0e5297e0493ecf3422ea88498be6299a2c179da318ff1deeab1ac48440d4a90cac8eb33c4545b985c687109953783b142fea4819c6f5.css integrity="sha512-SO3sjnHjxCQeGw5Sl+BJPs80IuqISYvmKZosF52jGP8d7qsaxIRA1KkMrI6zPEVFuYXGhxCZU3g7FC/qSBnG9Q=="><link rel=stylesheet type=text/css media=screen href=/css/custom.min.3e90b71df5994759c01a2c012d044795212a2436d2b36597893f83e31af62525d4571cc4135b3c4c2c634e0101d0c8e04be3d971ac8378e1ca15bf7d67d64eea.css integrity="sha512-PpC3HfWZR1nAGiwBLQRHlSEqJDbSs2WXiT+D4xr2JSXUVxzEE1s8TCxjTgEB0MjgS+PZcayDeOHKFb99Z9ZO6g=="><link rel=stylesheet type=text/css href=/css/dark.min.a6e1132ca354fccc5b438d5409cb8472d273c4d4df9bfc966733b6834ac01013a955ce583e386b9ed5bc2a5217255129b6389867b03bfa3b19ed78677816669a.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css media=screen href=/css/normalize.min.6b1cdb85ff89a0a19c4454992a82369dff0499f92605e8468157247c4d8920ad3577edea733674d303c5e7901508bdfd2a97c2da55e94c14f3dc8b658d9b2c5a.css integrity="sha512-axzbhf+JoKGcRFSZKoI2nf8EmfkmBehGgVckfE2JIK01d+3qczZ00wPF55AVCL39KpfC2lXpTBTz3ItljZssWg=="><script async src="https://www.googletagmanager.com/gtag/js?id=G-YW8V9DTR0N"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config',"G-YW8V9DTR0N")</script><script data-ad-client=ca-pub-8658473214995139 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><div class="container wrapper"><div class=header><base href=/><h1 class=site-title><a href=/>&lt;stdin></a>
<span class=blinking-cursor>|</span></h1><div class=site-description><h2 class=cursive>My Thoughts, Trials and Adventures</h2><nav class="nav social"><ul class=flat><a href=mailto:jagadeesh@stdin.top title=Mail><i class="far fa-envelope"></i></a><a href=https://github.com/jkotra/ title=Github><i class="fab fa-github"></i></a><a href=https://twitter.com/jagadeesh_kotra title=Twitter><i class="fab fa-twitter"></i></a><a href=index.xml title=RSS><i class="fas fa-rss"></i></a></ul></div><nav class=nav><ul class=flat><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/portfolio/>Portfolio</a></li><li><a href=http://lab.stdin.top>Lab</a></li><li><a href=/pgp/>PGP</a></li></ul></nav></div><div class=post><div class=post-header><h1 class=title>Sending mail using SMTP protocol</h1><div class=meta>Posted at &mdash; Sep 17, 2020</div></div><div class=markdown><h1 id=introduction>Introduction</h1><p>This article introduces the SMTP protocol and associated code and jargon. Next, we make a quick walkthrough of code to send mail to the smtp server.</p><h2 id=smtp-commands>SMTP commands.</h2><p><a href=https://users.cs.cf.ac.uk/Dave.Marshall/PERL/node175.html>Read Here</a></p><h3 id=flow>Flow</h3><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>(ON CONNECT) (expect 220)
HELO BOOMER (expect 250)
MAIL FROM (expect 250)
RCPT TO (expect 250)
DATA (expect 354)
(ON END OF EMAIL BODY) (expect 250)
QUIT (expect 221)
</code></pre></div><hr><div class="notices note"><p>the code explained here can be found in my <a href=https://github.com/jkotra/NetworkProgramming/blob/master/smtp/sendmail.c>NetworkProgramming GitHub repository</a>.</p></div><h1 id=sending-mail>Sending mail</h1><p>we start by importing required headers.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#099>#include</span> <span style=color:#099>&lt;sys/types.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;sys/socket.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;sys/select.h&gt;</span><span style=color:#099>
</span><span style=color:#099></span>
<span style=color:#099>#include</span> <span style=color:#099>&lt;netinet/in.h&gt;</span><span style=color:#099>
</span><span style=color:#099></span>
<span style=color:#099>#include</span> <span style=color:#099>&lt;netdb.h&gt;</span><span style=color:#099>
</span><span style=color:#099></span>
<span style=color:#099>#include</span> <span style=color:#099>&lt;ctype.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;stdio.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;time.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;string.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;unistd.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;stdbool.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;stdlib.h&gt;</span><span style=color:#099>
</span><span style=color:#099>#include</span> <span style=color:#099>&lt;errno.h&gt;</span><span style=color:#099>
</span></code></pre></div><p>SMTP server address and port are <code>#define</code>ed at start for ease of use later on.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#099>#define SMTPSERVER &#34;gmail-smtp-in.l.google.com&#34;
</span><span style=color:#099>#define SMTPPORT &#34;25&#34;
</span></code></pre></div><p>there are 3 functions in this program:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>void parse_code(char *server_response, char *resp);
int wait_for_response(int socket_fd, char *code);
int send_response(int socket_fd, char *request);
</code></pre></div><h3 id=parsing-code-from-a-string>Parsing code from a string</h3><p>code parsing from the string is handled by <code>parse_code</code> function.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#078;font-weight:700>void</span> <span style=color:#c0f>parse_code</span>(<span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>server_response, <span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>resp)
{

    <span style=color:#069;font-weight:700>for</span> (<span style=color:#078;font-weight:700>int</span> i <span style=color:#555>=</span> <span style=color:#f60>2</span>; i <span style=color:#555>&lt;</span> strlen(server_response); i<span style=color:#555>++</span>)
    {
        <span style=color:#069;font-weight:700>if</span> (isdigit(server_response[i]) <span style=color:#555>&amp;&amp;</span> isdigit(server_response[i <span style=color:#555>-</span> <span style=color:#f60>1</span>]) <span style=color:#555>&amp;&amp;</span> isdigit(server_response[i <span style=color:#555>-</span> <span style=color:#f60>1</span>]))
        {
            resp[<span style=color:#f60>0</span>] <span style=color:#555>=</span> server_response[i <span style=color:#555>-</span> <span style=color:#f60>2</span>];
            resp[<span style=color:#f60>1</span>] <span style=color:#555>=</span> server_response[i <span style=color:#555>-</span> <span style=color:#f60>1</span>];
            resp[<span style=color:#f60>2</span>] <span style=color:#555>=</span> server_response[i];

            <span style=color:#069;font-weight:700>break</span>;
        }
    }
}
</code></pre></div><p>The above function takes two parameters <code>char *server_response, char *resp</code>. the result if found will be stored in <code>resp</code>.</p><h1 id=sending-and-receiving>Sending and Receiving</h1><p>Sending and Receiving from the server is handled by two functions - <code>wait_for_response</code> and <code>send_response</code> respectively.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>wait_for_response</span>(<span style=color:#078;font-weight:700>int</span> socket_fd, <span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>code)
{

    <span style=color:#078;font-weight:700>char</span> response[<span style=color:#f60>1024</span>];
    <span style=color:#078;font-weight:700>char</span> code_resp[<span style=color:#f60>4</span>];

    <span style=color:#078;font-weight:700>int</span> recv_bytes <span style=color:#555>=</span> recv(socket_fd, response, <span style=color:#f60>1024</span>, <span style=color:#f60>0</span>);
    printf(<span style=color:#c30>&#34;Server: %s</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>, response);

    parse_code(response, code_resp);

    <span style=color:#069;font-weight:700>if</span> (strcmp(code_resp, code) <span style=color:#555>==</span> <span style=color:#f60>0</span>)
    {
        <span style=color:#069;font-weight:700>return</span> <span style=color:#366>true</span>;
    }
    <span style=color:#069;font-weight:700>else</span>
    {
        <span style=color:#069;font-weight:700>return</span> <span style=color:#366>false</span>;
    }
}

<span style=color:#078;font-weight:700>int</span> <span style=color:#c0f>send_response</span>(<span style=color:#078;font-weight:700>int</span> socket_fd, <span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>request)
{


    printf(<span style=color:#c30>&#34;Client: %s</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
    <span style=color:#078;font-weight:700>int</span> sent_bytes <span style=color:#555>=</span> send(socket_fd, request, strlen(request), <span style=color:#f60>0</span>);

}
</code></pre></div><hr><h2 id=main><code>main()</code></h2><p>we start the main function by initiating a socket.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>   <span style=color:#069;font-weight:700>struct</span> addrinfo hints;
    memset(<span style=color:#555>&amp;</span>hints, <span style=color:#f60>0</span>, <span style=color:#069;font-weight:700>sizeof</span>(hints));
    hints.ai_socktype <span style=color:#555>=</span> SOCK_STREAM;
    <span style=color:#069;font-weight:700>struct</span> addrinfo <span style=color:#555>*</span>peer_address;
    <span style=color:#069;font-weight:700>if</span> (getaddrinfo(SMTPSERVER, SMTPPORT, <span style=color:#555>&amp;</span>hints, <span style=color:#555>&amp;</span>peer_address))
    {
        fprintf(stderr, <span style=color:#c30>&#34;getaddrinfo() failed.</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }


    printf(<span style=color:#c30>&#34;Creating socket...</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
    <span style=color:#078;font-weight:700>int</span> server;
    server <span style=color:#555>=</span> socket(peer_address<span style=color:#555>-&gt;</span>ai_family,
                    peer_address<span style=color:#555>-&gt;</span>ai_socktype, peer_address<span style=color:#555>-&gt;</span>ai_protocol);

    printf(<span style=color:#c30>&#34;Connecting...</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
    <span style=color:#069;font-weight:700>if</span> (connect(server,
                peer_address<span style=color:#555>-&gt;</span>ai_addr, peer_address<span style=color:#555>-&gt;</span>ai_addrlen))
    {
        fprintf(stderr, <span style=color:#c30>&#34;connect() failed.</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }

    freeaddrinfo(peer_address);

    printf(<span style=color:#c30>&#34;Connected!</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
    
</code></pre></div><p>The above code takes care of address resolution and other things, for a detailed explanation see my posts with <code>network programming</code> tag.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;220&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
</code></pre></div><p>on connection with SMTP server, we expect a welcome message with code <code>220</code>. The program will exit if the code is mismatched.</p><p>Example response from SMTP server:</p><p><code>Server: 220 mx.google.com ESMTP s28si3735353pgn.104 - gsmtp</code></p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    send_response(server, <span style=color:#c30>&#34;HELO BOOMER</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);
    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;250&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
</code></pre></div><p>Next, we need to identify ourself to the server, this can be done by a messagein the format of <code>HELO [YOURNAME]</code></p><p>The SMTP server will greet us with code <code>250</code> followed by a vendor-specific human greeting.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>
    send_response(server, <span style=color:#c30>&#34;MAIL FROM:&lt;hekko@xyz.com&gt;</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);

    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;250&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
    
    send_response(server, <span style=color:#c30>&#34;RCPT TO:&lt;testing@gmail.com&gt;</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);

    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;250&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
</code></pre></div><p>We then send the details about our ourself and the recipient. we expect a <code>250</code> response from the server.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    send_response(server, <span style=color:#c30>&#34;DATA</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);

    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;354&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
</code></pre></div><p>We tell the server that we are going to send email data from the next message onwards by sending it a single word <code>DATA\r\n</code>. we expect the <code>354</code> code in response, this indicates the server is ready to receive data.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    send_response(server, <span style=color:#c30>&#34;From:&lt;hekko@xyz.com&gt;</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);
    send_response(server, <span style=color:#c30>&#34;To:&lt;hello@gmail.com&gt;</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);
    send_response(server, <span style=color:#c30>&#34;Subject:SMTP TEST</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);
</code></pre></div><p>the above code will the required details in the body to the server, note that all of these can be sent in one message (headers and body) subject to server acceptance.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    time_t timer;
    time(<span style=color:#555>&amp;</span>timer);

    <span style=color:#069;font-weight:700>struct</span> tm <span style=color:#555>*</span>timeinfo;
    timeinfo <span style=color:#555>=</span> gmtime(<span style=color:#555>&amp;</span>timer);

    <span style=color:#078;font-weight:700>char</span> date[<span style=color:#f60>128</span>];
    strftime(date, <span style=color:#f60>128</span>, <span style=color:#c30>&#34;%a, %d %b %Y %H:%M:%S +0000&#34;</span>, timeinfo);
    sprintf(date, <span style=color:#c30>&#34;Date:%s</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>, date);
    
    send_response(server, date);
    send_response(server, <span style=color:#c30>&#34;</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>);
</code></pre></div><p>our message must include a timestamp. we generate a timestamp to include in our email using <code>strftime()</code>.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#078;font-weight:700>char</span> helloworld_body[<span style=color:#f60>128</span>] <span style=color:#555>=</span> <span style=color:#c30>&#34;Hello World.</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>.</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>&#34;</span>;

    send_response(server, helloworld_body);

    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;250&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }
</code></pre></div><p>This the body of our mail, write your heart&rsquo;s content here ðŸ˜„ a simple <code>.</code> separated by <code>\r\n</code> will indicate that message is over.the server should return <code>250</code> code.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#069;font-weight:700>if</span> (<span style=color:#555>!</span>wait_for_response(server, <span style=color:#c30>&#34;221&#34;</span>)){
        printf(<span style=color:#c30>&#34;unexpected response</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        exit(<span style=color:#f60>1</span>);
    }


    close(server);
</code></pre></div><p>Finally, we send <code>QUIT\r\n</code> to the SMTP server. this formally completes our communication with the server. we then close the socket (<code>server</code>)</p><p>Congratulation, If everything works correctly, you should be able to send email using just C code.</p><div class="notices warning"><p>Most residential IP&rsquo;s are blocked to send an email. GMAIL does not allow it&rsquo;s SMTP servers to be used by individuals, the email we try to send is rejected by google for obvious reasons. See output below.</p></div><p>Output:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Creating socket...
Connecting...
Connected!
Server: <span style=color:#f60>220</span> mx.google.com ESMTP s28si3735353pgn.104 - gsmtp

Client: HELO BOOMER

Server: <span style=color:#f60>250</span> mx.google.com at your service

Client: MAIL FROM:&lt;hekko@xyz.com&gt;

Server: <span style=color:#f60>250</span> 2.1.0 OK s28si3735353pgn.104 - gsmtp
ï¿½-ï¿½
Client: RCPT TO:&lt;00.xog.00@gmail.com&gt;

Server: <span style=color:#f60>250</span> 2.1.5 OK s28si3735353pgn.104 - gsmtp
ï¿½-ï¿½
Client: DATA

Server: <span style=color:#f60>354</span>  Go ahead s28si3735353pgn.104 - gsmtp
-ï¿½
Client: From:&lt;hekko@xyz.com&gt;

Client: To:&lt;hello@gmail.com&gt;

Client: Subject:SMTP TEST

Client: Date:Date:17 Sep <span style=color:#f60>2020</span> 09:31:23 +0000

Client: 

Client: Hello World.
.

Server: 421-4.7.0 <span style=color:#555>[</span>223.230.89.223      15<span style=color:#555>]</span> Our system has detected that this message is
421-4.7.0 suspicious due to the very low reputation of the sending IP address.
421-4.7.0 To protect our users from spam, mail sent from your IP address has
421-4.7.0 been temporarily rate limited. Please visit
<span style=color:#f60>421</span> 4.7.0  https://support.google.com/mail/answer/188131 <span style=color:#069;font-weight:700>for</span> more information. s28si3735353pgn.104 - gsmtp

unexpected response
</code></pre></div><hr><h1 id=conclusion>Conclusion</h1><p>This is a very basic example of SMTP protocol which is a de facto way to send emails to each other.</p><p>I hope you learned something in this article. A working production SMTP client would generally look like this albeit with extra nuts and bolts to handle additional security and authorization.</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/network-programming>network programming</a></li><li><a href=/tags/c>c</a></li></ul></nav></div><div id=commento></div><script id=comments src=https://utteranc.es/client.js repo=jkotra/stdin.top-comments issue-term=pathname label=ðŸ’¬ theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the
<a href=https://commento.io/>comments powered by Commento.</a></noscript></div><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script></div></div><div class="footer wrapper"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8658473214995139 data-ad-slot=2398602558 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><br><nav class=nav><div class=badge><a href=https://creativecommons.org/licenses/by-sa/4.0/><img src=/cc/by-sa.png></a></div><div><a href=https://gitlab.com/synk.0x1/kavi-hugo-theme>Kavi</a> (based on <a href=https://github.com/vividvilla/ezhil>ezhil</a>)</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>