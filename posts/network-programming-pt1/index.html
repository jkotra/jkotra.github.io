<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://stdin.top/posts/network-programming-pt1/><meta name=description content="📡 Introduction to TCP and basic 'Hello World!' web server!"><meta name=language content="en"><link rel=sitemap type=application/xml title=Sitemap href=https://stdin.top/sitemap.xml><title>Network programming Pt. 1 - TCP and Hello World! :: &lt;stdin></title><link rel=icon type=image/png href=/static/chip.png><meta property="og:title" content="Network programming Pt. 1 - TCP and Hello World!"><meta property="og:description" content="📡 Introduction to TCP and basic 'Hello World!' web server!"><meta property="og:type" content="article"><meta property="og:url" content="https://stdin.top/posts/network-programming-pt1/"><meta property="og:image" content="https://stdin.top/images/8g8yX84.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-27T16:40:15+05:30"><meta property="article:modified_time" content="2023-05-11T19:55:50+05:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://stdin.top/images/8g8yX84.jpg"><meta name=twitter:title content="Network programming Pt. 1 - TCP and Hello World!"><meta name=twitter:description content="📡 Introduction to TCP and basic 'Hello World!' web server!"><meta name=theme-color content="#2e2847"><link defer href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link defer href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel=stylesheet><script src=https://stdin.top/js/main.min.6a2ed298f6a8cafbfa5c622ca55cb5be5632cc37b845fc6b58d9d383cf7ec77e9faaedd88196d0d58c0040873d5689898701e5ed30cac06dae52c78f9c0ddc31.js integrity="sha512-ai7SmPaoyvv6XGIspVy1vlYyzDe4RfxrWNnTg89+x36fqu3YgZbQ1YwAQIc9VomJhwHl7TDKwG2uUsePnA3cMQ=="></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css integrity="sha512-8jdwayz5n8F2cnW26l9vpV6+yGOcRAqz6HTu+DQ3FtVIAts2gTdlFZOGpYhvBMXkWEgxPN3Y22UWyZXuDowNLA==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/regular.min.css integrity="sha512-qgtcTTDJDk6Fs9eNeN1tnuQwYjhnrJ8wdTVxJpUTkeafKKP6vprqRx5Sj/rB7Q57hoYDbZdtHR4krNZ/11zONg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/brands.min.css integrity="sha512-AMDXrE+qaoUHsd0DXQJr5dL4m5xmpkGLxXZQik2TvR2VCVKT/XRPQ4e/LTnwl84mCv+eFm92UG6ErWDtGM/Q5Q==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/solid.min.css integrity="sha512-QN7X/bUbbeel9bbq6JVNJXk1Zowt+n+QPN+DjhEmTa4TdL1YPCsCey5JrvfRW8xp28LDYgGG/waNVdrhwMQmVQ==" crossorigin=anonymous><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/main.min.dc3edd6ae540bf87b9aeab2175e2a0d0f2445f17589e60d223f6d57cf330c8f3b6dced4c45491d9dd6b3d91aa4776adbda6cd10e2ec77fc67671618970ebd7ab.css integrity="sha512-3D7dauVAv4e5rqshdeKg0PJEXxdYnmDSI/bVfPMwyPO23O1MRUkdndaz2Rqkd2rb2mzRDi7Hf8Z2cWGJcOvXqw=="><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/custom.min.757b18759462b15e8897dc209b4b095bd251a2f738a618a40eea280f31a1a3f6edcb894da93e006c4aa6a1f6e1f67f3c083ea566d1a2ad2e9e7b0a68dc2a257a.css integrity="sha512-dXsYdZRisV6Il9wgm0sJW9JRovc4phikDuooDzGho/bty4lNqT4AbEqmofbh9n88CD6lZtGirS6eewpo3Coleg=="><link rel=stylesheet type=text/css href=https://stdin.top/css/dark.min.7a85efc733bdb0bf14b310fa5de03054b475ca1846babf715d4f15fd0863f9e7074ea0e3548e662a608d8710563460786a7df68ecde3e66abcfa6fcf21fa5888.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/normalize.min.15dd2454cf02be612cd84be5a0307ecae7e9c84d08f88ab2d1e9332717d10fe9b63484bb4c5352072da0915d1a6d48fa41994fb99c120c891cca431b4448f44d.css integrity="sha512-Fd0kVM8CvmEs2EvloDB+yufpyE0I+Iqy0ekzJxfRD+m2NIS7TFNSBy2gkV0abUj6QZlPuZwSDIkcykMbREj0TQ=="><script async src="https://www.googletagmanager.com/gtag/js?id=G-YW8V9DTR0N"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YW8V9DTR0N",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8658473214995139" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><base href=https://stdin.top/><h1 class=site-title><a href=https://stdin.top/>&lt;stdin></a>
<span class=blinking-cursor>|</span></h1><div class=site-description><h2 class=cursive>My Thoughts, Trials and Adventures</h2><nav class="nav social"><ul class=flat><a href=mailto:jagadeesh@stdin.top title=Mail><i class="far fa-envelope"></i></a>
<a href=https://github.com/jkotra/ title=Github><i class="fab fa-github"></i></a>
<a href=https://twitter.com/jagadeesh_kotra title=Twitter><i class="fab fa-twitter"></i></a>
<a href=index.xml title=RSS><i class="fas fa-rss"></i></a></ul></div><nav class=nav><ul class=flat><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/portfolio/>Portfolio</a></li><li><a href=/pgp/>PGP</a></li></ul></nav></div><div class=post><div class=post-header><h1 class=title>Network programming Pt. 1 - TCP and Hello World!</h1><div class=meta>Posted at &mdash; Aug 27, 2020
| Last Modified on &mdash; May 11, 2023</div></div><div class=markdown><h1 id=introduction>Introduction</h1><p>a short introduction to <a href=https://en.wikipedia.org/wiki/Transmission_Control_Protocol>TCP</a> and code walkthrough of a simple TCP web server.</p><h2 id=tcp-protocol>TCP protocol</h2><p>The Transmission Control Protocol (TCP) is one of the main protocols of the Internet protocol suite. It originated in the initial network implementation in which it complemented the Internet Protocol (IP). Therefore, the entire suite is commonly referred to as TCP/IP. TCP provides reliable, ordered, and error-checked delivery of a stream of octets (bytes) between applications running on hosts communicating via an IP network. Major internet applications such as the World Wide Web, email, remote administration, and file transfer rely on TCP, which is part of the Transport Layer of the TCP/IP suite. SSL/TLS often runs on top of TCP.</p><p>Source: <a href=https://en.wikipedia.org/wiki/Transmission_Control_Protocol>Wikipedia</a></p><div class="notices note"><p>TCP is a streaming protocol whereas UDP is a connectionless protocol.</p></div><h2 id=code>Code</h2><div class="notices note"><p>the code explained here can be found in my <a href=https://github.com/jkotra/NetworkProgramming/blob/master/hello.c>NetworkProgramming GitHub repository</a>.</p></div><h1 id=walkthrough>Walkthrough</h1><p>we need a bunch of header files that contain different functions and structures that we need.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/socket.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;netinet/in.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;netdb.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdbool.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAX_BACKLOG 10
</span></span></span><span class=line><span class=cl><span class=cp>#define PORT &#34;8080&#34;
</span></span></span></code></pre></div><h2 id=header-breakdown>Header Breakdown</h2><table><thead><tr><th>Header</th><th>what for?</th></tr></thead><tbody><tr><td><a href=https://pubs.opengroup.org/onlinepubs/007904975/basedefs/sys/types.h.html>sys/types.h</a></td><td>system types. used in cpmbination with <code>sys/socket.h</code> for compatibily on all unix-like systems.</td></tr><tr><td><a href=https://pubs.opengroup.org/onlinepubs/007908799/xns/syssocket.h.html>sys/socket.h</a></td><td><code>socket(), bind(), connect(), accept(), send()</code> etc..</td></tr><tr><td><a href=https://pubs.opengroup.org/onlinepubs/000095399/basedefs/netinet/in.h.html>netinet/in.h</a></td><td>Internet address family - structures for <code>IPV4</code> <code>IPV6</code> etc.</td></tr><tr><td><a href=https://pubs.opengroup.org/onlinepubs/007908799/xns/netdb.h.html>netdb.h</a></td><td><code>getaddrinfo()</code> <code>getnameinfo()</code> etc..</td></tr></tbody></table><hr><p><figure><img src=/images/tcp_server.png alt="TCP server"><figcaption>TCP server flowchart</figcaption></figure></p><p>we start by calling <code>init_server()</code> function. this function will create a socket and bind it to a port.</p><p><code>init_server</code> return&rsquo;s a socket descriptor (<code>> 0</code>) if the socket is created and the address is successfully binded.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>socketfd</span> <span class=o>=</span> <span class=nf>init_server</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>socketfd</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;cannot init_server()&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>this is our <code>init_server()</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>init_server</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>addrinfo</span> <span class=n>hints</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>addrinfo</span> <span class=o>*</span><span class=n>bind_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>hints</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>hints</span><span class=p>));</span> <span class=c1>//zero out!
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>hints</span><span class=p>.</span><span class=n>ai_family</span> <span class=o>=</span> <span class=n>AF_INET</span><span class=p>;</span>       <span class=c1>// we need ipv4
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>hints</span><span class=p>.</span><span class=n>ai_socktype</span> <span class=o>=</span> <span class=n>SOCK_STREAM</span><span class=p>;</span> <span class=c1>// TCP
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>hints</span><span class=p>.</span><span class=n>ai_flags</span> <span class=o>=</span> <span class=n>AI_PASSIVE</span><span class=p>;</span>     <span class=c1>// PASSIVE mode
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nf>getaddrinfo</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>PORT</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>hints</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>bind_addr</span><span class=p>);</span> <span class=c1>//get local address from system.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>//init socket
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>socketfd</span> <span class=o>=</span> <span class=nf>socket</span><span class=p>(</span><span class=n>bind_addr</span><span class=o>-&gt;</span><span class=n>ai_family</span><span class=p>,</span> <span class=n>bind_addr</span><span class=o>-&gt;</span><span class=n>ai_socktype</span><span class=p>,</span> <span class=n>bind_addr</span><span class=o>-&gt;</span><span class=n>ai_protocol</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>bind</span><span class=p>(</span><span class=n>socketfd</span><span class=p>,</span> <span class=n>bind_addr</span><span class=o>-&gt;</span><span class=n>ai_addr</span><span class=p>,</span> <span class=n>bind_addr</span><span class=o>-&gt;</span><span class=n>ai_addrlen</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>socketfd</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol><li>we first start by declaring two structs of <code>addrinfo</code> - <code>hints</code> and <code>bind_addr</code></li><li>we must zero out the struct struct <code>memset()</code>. this will remove any garbage data from it and set all friends to <code>0</code>.</li><li>set fields in <code>hints</code> struct. (refer to inline comments).</li></ol><div class="notices tip"><p>we only need to set <code>hints.ai_socktype</code> in a <strong>TCP client</strong> scenario. more on that in later parts.</p></div><ol start=4><li>we then call <code>getaddrinfo()</code>. it&rsquo;s defined as:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getaddrinfo</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>node</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>service</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>const</span> <span class=k>struct</span> <span class=n>addrinfo</span> <span class=o>*</span><span class=n>hints</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>struct</span> <span class=n>addrinfo</span> <span class=o>**</span><span class=n>res</span><span class=p>);</span>
</span></span></code></pre></div><p>set <code>NULL</code> as the first argument(<em>node</em>) indicating we need an address from system, 2nd arg. is our desired port, 3rd arg is <code>hints</code> struct passed as a ref, the result of this is stored in <code>bind_addr</code> struct that we defined above and passed as a ref as 4th arg.</p><ol start=5><li><p>we start a socket by passing the required parameters from <code>bind_addr</code> struct. it will return a negative number on failure. a positive number is returned on successful creation of socket, this number indicates the file descriptor associated with the socket.</p></li><li><p>we call <code>bind()</code>. this will bind the IP to port. <code>bind()</code> returns a negative number on failure.</p></li><li><p>finally we return the <code>socket_fd</code></p></li></ol><p>Back to <code>main()</code>
we then call <code>listen()</code> with two arguments, 1st arg is <code>socket_fd</code> and second one is <code>MAX_BACKLOG</code> - this is the maximum number of simultanious connection that our socket will accept before refusing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//start listining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nf>listen</span><span class=p>(</span><span class=n>socketfd</span><span class=p>,</span> <span class=n>MAX_BACKLOG</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;✅ server listining on 127.0.0.1:%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>PORT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;❌ cannot listen()! %d </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=nf>listen</span><span class=p>(</span><span class=n>socketfd</span><span class=p>,</span> <span class=n>MAX_BACKLOG</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>we then call to <code>accept_and_send()</code> function with <code>socket_fd</code> as arg. this function will accept incoming connections (forwarded by <code>listen()</code>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>accept_and_send</span><span class=p>(</span><span class=n>socketfd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></div><p><code>accept_and_send()</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>accept_and_send</span><span class=p>(</span><span class=kt>int</span> <span class=n>socketfd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>sockaddr_storage</span> <span class=n>client_addr</span><span class=p>;</span> <span class=c1>//to store client addr
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>socklen_t</span> <span class=n>client_addr_len</span><span class=p>;</span>           <span class=c1>//length of client addr;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>client</span> <span class=o>=</span> <span class=nf>accept</span><span class=p>(</span><span class=n>socketfd</span><span class=p>,</span> <span class=p>(</span><span class=k>struct</span> <span class=n>sockaddr</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>client_addr</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>client_addr_len</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>client</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;cannot accept connection from client!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>addr_buffer</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span> <span class=c1>//empty buf. to store ip.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nf>getnameinfo</span><span class=p>((</span><span class=k>struct</span> <span class=n>sockaddr</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>client_addr</span><span class=p>,</span> <span class=n>client_addr_len</span><span class=p>,</span> <span class=n>addr_buffer</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>addr_buffer</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>NI_NUMERICHOST</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;client IP: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>addr_buffer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// HANDLE / READ REQ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>request</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bytes_received</span> <span class=o>=</span> <span class=nf>recv</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=mi>1024</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//send response
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>response</span> <span class=o>=</span> <span class=s>&#34;HTTP/1.1 200 OK</span><span class=se>\r\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>                           <span class=s>&#34;Connection: close</span><span class=se>\r\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>                           <span class=s>&#34;Content-Type: text/plain</span><span class=se>\r\n\r\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>                           <span class=s>&#34;Hello World from hello.c&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bytes_sent</span> <span class=o>=</span> <span class=nf>send</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>response</span><span class=p>),</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>close</span><span class=p>(</span><span class=n>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol><li><p>we start the function by declaring two structs - <code>client_addr</code> and <code>client_addr_len</code>
<code>sockaddr_storage</code> stores the client address. <code>client_addr_len</code> stores lenth of client address.</p></li><li><p>we call <code>accept()</code>. this will accept the client connection and store the details in above-declared structs.it returns <code>-1</code> on failure. this returns a file descriptor for the accepted socket that we can use to send and receive data from the client.</p></li></ol><p>optionally, we can get ip address of client using <code>getnameinfo()</code>. <code>getnameinfo()</code> is essentially inverse of <code>getaddrinfo()</code>.</p><ol start=4><li><p>TCP connection is initiated by receiving data from the client. this acts as a handshake between client and server.</p></li><li><p>we can then send data to the client, we use <code>send()</code>. to send data to the client.</p></li><li><p>close the connection by closing the client file descriptor.</p></li></ol><div class="notices tip"><p><p>it&rsquo;s always a good practice to close socket at end of program.</p><p><code>close(socket_fd)</code></p></p></div><h1 id=lets-test-it-out>Let&rsquo;s test it out!</h1><p>compile the program using <code>gcc</code></p><p><code>gcc hello.c -o hello</code></p><p>Run the program</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>~/Documents/Projects/network_programming » ./hello 
</span></span><span class=line><span class=cl>socketfd = 3
</span></span><span class=line><span class=cl>✅ server listining on 127.0.0.1:8080
</span></span></code></pre></div><p>open a browser and navigate to <code>http://127.0.0.1:8080/</code></p><p>you should see a nice message from our webserver:</p><p><code>Hello World from hello.c</code></p><hr><h1 id=conclusion>Conclusion</h1><p>My humble attempt to re-explain network programming concepts and code in C as I learn them myself, I hope this series helps in your learning and also serves as a note-keeping for me 😊</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/network-programming>network programming</a></li><li><a href=/tags/c>c</a></li></ul></nav></div><div id=commento></div><script onload=setCommentsTheme() id=comments src=https://utteranc.es/client.js repo=jkotra/stdin.top-comments issue-term=pathname label=💬 theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the
<a href=https://commento.io/>comments powered by Commento.</a></noscript></div><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js></script>
<script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script></div></div><div class="footer wrapper"><script src=https://stdin.top/js/clipboard.min.988b4327074a4060e229a35c60cd186ef38420c9eb8b5eda4d19c4d29554742bf34e24b10eacaf02cce8d9a92e398fc4d47ed6a10f98d3f8a0bf68d2ac373e60.js integrity="sha512-mItDJwdKQGDiKaNcYM0YbvOEIMnri17aTRnE0pVUdCvzTiSxDqyvAszo2akuOY/E1H7WoQ+Y0/igv2jSrDc+YA=="></script><nav class=nav><div class=badge><a href=https://creativecommons.org/licenses/by-sa/4.0/ aria-label="CC BY-SA 4.0"><img alt="cc by-sa badge" src=/cc/by-sa.png></a></div><div><a href=https://github.com/jkotra/kavi-hugo-theme>Kavi</a> (based on <a href=https://github.com/vividvilla/ezhil>ezhil</a>)</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>