<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=https://stdin.top/posts/what-changed-in-wpc-1.0-a-lot/><meta name=description content="Changelog and motivations behind WPC 1.0."><meta name=language content="en"><link rel=sitemap type=application/xml title=Sitemap href=https://stdin.top/sitemap.xml><title>What changed in WPC 1.0? a lot. :: &lt;stdin></title><link rel=icon type=image/png href=/static/chip.png><meta property="og:title" content="What changed in WPC 1.0? a lot."><meta property="og:description" content="Changelog and motivations behind WPC 1.0."><meta property="og:type" content="article"><meta property="og:url" content="https://stdin.top/posts/what-changed-in-wpc-1.0-a-lot/"><meta property="og:image" content="https://stdin.top/images/wpc_featured.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-14T02:07:19+05:30"><meta property="article:modified_time" content="2021-03-07T19:43:34+05:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://stdin.top/images/wpc_featured.jpg"><meta name=twitter:title content="What changed in WPC 1.0? a lot."><meta name=twitter:description content="Changelog and motivations behind WPC 1.0."><meta name=theme-color content="#2e2847"><link defer href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link defer href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel=stylesheet><script src=https://stdin.top/js/main.min.6a2ed298f6a8cafbfa5c622ca55cb5be5632cc37b845fc6b58d9d383cf7ec77e9faaedd88196d0d58c0040873d5689898701e5ed30cac06dae52c78f9c0ddc31.js integrity="sha512-ai7SmPaoyvv6XGIspVy1vlYyzDe4RfxrWNnTg89+x36fqu3YgZbQ1YwAQIc9VomJhwHl7TDKwG2uUsePnA3cMQ=="></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css integrity="sha512-8jdwayz5n8F2cnW26l9vpV6+yGOcRAqz6HTu+DQ3FtVIAts2gTdlFZOGpYhvBMXkWEgxPN3Y22UWyZXuDowNLA==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/regular.min.css integrity="sha512-qgtcTTDJDk6Fs9eNeN1tnuQwYjhnrJ8wdTVxJpUTkeafKKP6vprqRx5Sj/rB7Q57hoYDbZdtHR4krNZ/11zONg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/brands.min.css integrity="sha512-AMDXrE+qaoUHsd0DXQJr5dL4m5xmpkGLxXZQik2TvR2VCVKT/XRPQ4e/LTnwl84mCv+eFm92UG6ErWDtGM/Q5Q==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/solid.min.css integrity="sha512-QN7X/bUbbeel9bbq6JVNJXk1Zowt+n+QPN+DjhEmTa4TdL1YPCsCey5JrvfRW8xp28LDYgGG/waNVdrhwMQmVQ==" crossorigin=anonymous><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/main.min.dc3edd6ae540bf87b9aeab2175e2a0d0f2445f17589e60d223f6d57cf330c8f3b6dced4c45491d9dd6b3d91aa4776adbda6cd10e2ec77fc67671618970ebd7ab.css integrity="sha512-3D7dauVAv4e5rqshdeKg0PJEXxdYnmDSI/bVfPMwyPO23O1MRUkdndaz2Rqkd2rb2mzRDi7Hf8Z2cWGJcOvXqw=="><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/custom.min.757b18759462b15e8897dc209b4b095bd251a2f738a618a40eea280f31a1a3f6edcb894da93e006c4aa6a1f6e1f67f3c083ea566d1a2ad2e9e7b0a68dc2a257a.css integrity="sha512-dXsYdZRisV6Il9wgm0sJW9JRovc4phikDuooDzGho/bty4lNqT4AbEqmofbh9n88CD6lZtGirS6eewpo3Coleg=="><link rel=stylesheet type=text/css href=https://stdin.top/css/dark.min.7a85efc733bdb0bf14b310fa5de03054b475ca1846babf715d4f15fd0863f9e7074ea0e3548e662a608d8710563460786a7df68ecde3e66abcfa6fcf21fa5888.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css media=screen href=https://stdin.top/css/normalize.min.15dd2454cf02be612cd84be5a0307ecae7e9c84d08f88ab2d1e9332717d10fe9b63484bb4c5352072da0915d1a6d48fa41994fb99c120c891cca431b4448f44d.css integrity="sha512-Fd0kVM8CvmEs2EvloDB+yufpyE0I+Iqy0ekzJxfRD+m2NIS7TFNSBy2gkV0abUj6QZlPuZwSDIkcykMbREj0TQ=="><script async src="https://www.googletagmanager.com/gtag/js?id=G-YW8V9DTR0N"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YW8V9DTR0N",{anonymize_ip:!1})}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8658473214995139" crossorigin=anonymous></script></head><body><div class="container wrapper"><div class=header><base href=https://stdin.top/><h1 class=site-title><a href=https://stdin.top/>&lt;stdin></a>
<span class=blinking-cursor>|</span></h1><div class=site-description><h2 class=cursive>My Thoughts, Trials and Adventures</h2><nav class="nav social"><ul class=flat><a href=mailto:jagadeesh@stdin.top title=Mail><i class="far fa-envelope"></i></a>
<a href=https://github.com/jkotra/ title=Github><i class="fab fa-github"></i></a>
<a href=https://twitter.com/jagadeesh_kotra title=Twitter><i class="fab fa-twitter"></i></a>
<a href=index.xml title=RSS><i class="fas fa-rss"></i></a></ul></div><nav class=nav><ul class=flat><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/portfolio/>Portfolio</a></li><li><a href=/pgp/>PGP</a></li></ul></nav></div><div class=post><div class=post-header><h1 class=title>What changed in WPC 1.0? a lot.</h1><div class=meta>Posted at &mdash; Jan 14, 2021
| Last Modified on &mdash; Mar 7, 2021</div></div><div class=markdown><h1 id=introduction>Introduction</h1><p><code>WPC 1.0</code> has been released and with a whole set of new features and most importantly readable, refactored and <em>saner</em> code which should make things easy for any hackers/tinkerers out there.</p><p>Compared to a mid-release (<code>0.5</code>) which up to that point is pretty much bug fixing there are some noticeable new features to end user that started in <code>0.5</code> and finally stable in <code>1.0</code>:</p><ul><li>Asynchronous downloads.</li><li>Asynchronous API calls to <a href=https://reddit.com/>Reddit</a> and Bing.</li><li>download wallpapers from any subreddit. (<code>--reddit</code>)</li><li>convert image to grayscale before setting it as wallpaper (<code>--grayscale</code>)</li><li>filter based on the age of the file. (<code>--maxage</code>)</li></ul><h1 id=refactoring>Refactoring</h1><p>This took the most time, even more so than any feature. my decision(obviously not well thought of ðŸ˜•) not to come up with a flexible design pattern at the start of the project led to this, something that looked worse than a script with hard interdependency. The refactoring is not necessary for working functionality but it&rsquo;s of much significance if any more features are to be implemented(or removed) in the future.</p><p>Much of <code>main.rs</code> has been further cleaned. any new web plugins can be implemented in just a few lines of code as the process of downloading and saving the file(s) has been abstracted away to their respective files in the <code>web</code> dir of the project.</p><p>for example, in the previous versions, the <code>main()</code> handled everything: the calls, parsing, downloading and it became a huge mess. with <code>1.0</code> all of this has been abstracted into their respective file and <code>main()</code> simply calls <code>update()</code> on the struct, the arguments are all the same for all, <code>savepath</code>, <code>maxage</code>, and reference to <code>WPCDebug</code> impl. which prints out messages if debug is enabled (<code>-D</code>)</p><p>an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>Bing</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Bing</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>update</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>savepath</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>wpc_debug</span>: <span class=kp>&amp;</span><span class=nc>WPCDebug</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>get</span><span class=p>().</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>file_list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>misc</span>::<span class=n>download_wallpapers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>savepath</span><span class=p>,</span><span class=w> </span><span class=n>wpc_debug</span><span class=p>).</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>file_list</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>get_bing_wpod</span><span class=p>().</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>(a number too many to note down) small typos and bugs have been fixed to achieve what I believe is now feature complete. I don&rsquo;t intend to do any radical/breaking changes, just enough bug fixes to keep it sweet, simple, and most importantly functional.</p><p>a major reason for refactoring the code is also because of the prospect that web sources may die or change API among other zillion things that could go wrong when depending on 3rd party APIs. If I were to maintain this (i mostly use local images anyway), the Web API dependent code must be independent of the program itself to some degree and a clear distinction between OS API&rsquo;s (the process of changing wallpaper for example, which is unlikely to change in future (hopefully ðŸ˜‰).</p><div class="notices info"><p>Previous developments to WPC have been documented in <a href=/posts/wpc-overview>this</a> article.</p></div></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/rust>Rust</a></li></ul></nav></div><div id=commento></div><script onload=setCommentsTheme() id=comments src=https://utteranc.es/client.js repo=jkotra/stdin.top-comments issue-term=pathname label=ðŸ’¬ theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the
<a href=https://commento.io/>comments powered by Commento.</a></noscript></div><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js></script>
<script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script></div></div><div class="footer wrapper"><script src=https://stdin.top/js/clipboard.min.988b4327074a4060e229a35c60cd186ef38420c9eb8b5eda4d19c4d29554742bf34e24b10eacaf02cce8d9a92e398fc4d47ed6a10f98d3f8a0bf68d2ac373e60.js integrity="sha512-mItDJwdKQGDiKaNcYM0YbvOEIMnri17aTRnE0pVUdCvzTiSxDqyvAszo2akuOY/E1H7WoQ+Y0/igv2jSrDc+YA=="></script><nav class=nav><div class=badge><a href=https://creativecommons.org/licenses/by-sa/4.0/ aria-label="CC BY-SA 4.0"><img alt="cc by-sa badge" src=/cc/by-sa.png></a></div><div><a href=https://github.com/jkotra/kavi-hugo-theme>Kavi</a> (based on <a href=https://github.com/vividvilla/ezhil>ezhil</a>)</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>