<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><base href=/posts/network-programming-pt2/><meta name=description content="communicate with TCP servers and websites(HTTP)ðŸŒŽ"><meta name=language content="en"><link rel=sitemap type=application/xml title=Sitemap href=/sitemap.xml><title>Network Programming Pt 2 - TCP client :: &lt;stdin></title><link rel=icon type=image/png href=/static/chip.png><meta property="og:title" content="Network Programming Pt 2 - TCP client"><meta property="og:description" content="communicate with TCP servers and websites(HTTP)ðŸŒŽ"><meta property="og:type" content="article"><meta property="og:url" content="/posts/network-programming-pt2/"><meta property="og:image" content="https://i.imgur.com/8g8yX84.jpg"><meta property="article:published_time" content="2020-08-31T01:49:14+05:30"><meta property="article:modified_time" content="2020-08-31T01:49:14+05:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.imgur.com/8g8yX84.jpg"><meta name=twitter:title content="Network Programming Pt 2 - TCP client"><meta name=twitter:description content="communicate with TCP servers and websites(HTTP)ðŸŒŽ"><meta name=theme-color content="#2e2847"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel=stylesheet><script src=/js/main.min.ecbcd6a34b475cd2e844a02b80083902ac50d4c1f119178abd429ba42d436bfd4b5529b4a51b9127c9330664e1ad9e846c06f856295b40105bea6d7e2a6c3326.js integrity="sha512-7LzWo0tHXNLoRKArgAg5AqxQ1MHxGReKvUKbpC1Da/1LVSm0pRuRJ8kzBmThrZ6EbAb4VilbQBBb6m1+KmwzJg=="></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css integrity="sha512-8jdwayz5n8F2cnW26l9vpV6+yGOcRAqz6HTu+DQ3FtVIAts2gTdlFZOGpYhvBMXkWEgxPN3Y22UWyZXuDowNLA==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/regular.min.css integrity="sha512-qgtcTTDJDk6Fs9eNeN1tnuQwYjhnrJ8wdTVxJpUTkeafKKP6vprqRx5Sj/rB7Q57hoYDbZdtHR4krNZ/11zONg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/brands.min.css integrity="sha512-AMDXrE+qaoUHsd0DXQJr5dL4m5xmpkGLxXZQik2TvR2VCVKT/XRPQ4e/LTnwl84mCv+eFm92UG6ErWDtGM/Q5Q==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/solid.min.css integrity="sha512-QN7X/bUbbeel9bbq6JVNJXk1Zowt+n+QPN+DjhEmTa4TdL1YPCsCey5JrvfRW8xp28LDYgGG/waNVdrhwMQmVQ==" crossorigin=anonymous><link rel=stylesheet type=text/css media=screen href=/css/main.min.11e4fae581d29b4f1d9ee81e1c11e70ef64db60ae869076aa75b9212ffe3098417b4019c294384255339a37a864d37e4dd7a55ee05fd953536c1ddc11bf952a2.css integrity="sha512-EeT65YHSm08dnugeHBHnDvZNtgroaQdqp1uSEv/jCYQXtAGcKUOEJVM5o3qGTTfk3XpV7gX9lTU2wd3BG/lSog=="><link rel=stylesheet type=text/css media=screen href=/css/custom.min.3e90b71df5994759c01a2c012d044795212a2436d2b36597893f83e31af62525d4571cc4135b3c4c2c634e0101d0c8e04be3d971ac8378e1ca15bf7d67d64eea.css integrity="sha512-PpC3HfWZR1nAGiwBLQRHlSEqJDbSs2WXiT+D4xr2JSXUVxzEE1s8TCxjTgEB0MjgS+PZcayDeOHKFb99Z9ZO6g=="><link rel=stylesheet type=text/css href=/css/dark.min.a6e1132ca354fccc5b438d5409cb8472d273c4d4df9bfc966733b6834ac01013a955ce583e386b9ed5bc2a5217255129b6389867b03bfa3b19ed78677816669a.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css media=screen href=/css/normalize.min.112c04d26fa13a6d29cec753a0959b82339c03760baa50dc705accbb85d7b83e02b7a3691b24d116b6e619c311eacb3f2f96529bcf0b45d8ae35759f9f35d52e.css integrity="sha512-ESwE0m+hOm0pzsdToJWbgjOcA3YLqlDccFrMu4XXuD4Ct6NpGyTRFrbmGcMR6ss/L5ZSm88LRdiuNXWfnzXVLg=="><script async src="https://www.googletagmanager.com/gtag/js?id=G-YW8V9DTR0N"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config',"G-YW8V9DTR0N");</script><script data-ad-client=ca-pub-8658473214995139 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><div class="container wrapper"><div class=header><base href=/><h1 class=site-title><a href=/>&lt;stdin></a>
<span class=blinking-cursor>|</span></h1><div class=site-description><h2 class=cursive>My Thoughts, Trials and Adventures</h2><nav class="nav social"><ul class=flat><a href=mailto:jagadeesh@stdin.top title=Mail><i class="far fa-envelope"></i></a><a href=https://github.com/jkotra/ title=Github><i class="fab fa-github"></i></a><a href=https://twitter.com/jagadeesh_kotra title=Twitter><i class="fab fa-twitter"></i></a><a href=index.xml title=RSS><i class="fas fa-rss"></i></a></ul></div><nav class=nav><ul class=flat><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/portfolio/>Portfolio</a></li><li><a href=http://lab.stdin.top>Lab</a></li><li><a href=/pgp/>PGP</a></li></ul></nav></div><div class=post><div class=post-header><h1 class=title>Network Programming Pt 2 - TCP client</h1><div class=meta>Posted at &mdash; Aug 31, 2020</div></div><div class=markdown><h1 id=introduction>Introduction</h1><p>HTTP is powered by TCP, websites can be retrieved by communicating through TCP socket. this a code walkthrough of c program to retrieve <code>example.com</code></p><h1 id=tcp-client>TCP client</h1><div class="notices note"><p>the code explained here can be found in my <a href=https://github.com/jkotra/NetworkProgramming/blob/master/tcp_client_classic.c>NetworkProgramming GitHub repository</a>.</p></div><p><figure><img src=/images/tcp_client.png alt=Flowchart><figcaption>TCP client flowchart</figcaption></figure></p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#069;font-weight:700>struct</span> addrinfo hints;

    memset(<span style=color:#555>&amp;</span>hints, <span style=color:#f60>0</span>, <span style=color:#069;font-weight:700>sizeof</span>(hints));

    <span style=color:#069;font-weight:700>struct</span> addrinfo <span style=color:#555>*</span>peer;
    hints.ai_socktype <span style=color:#555>=</span> SOCK_STREAM;

    printf(<span style=color:#c30>&#34;args: %s %s</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>, argv[<span style=color:#f60>1</span>], argv[<span style=color:#f60>2</span>]);

    <span style=color:#069;font-weight:700>if</span> (getaddrinfo(argv[<span style=color:#f60>1</span>], argv[<span style=color:#f60>2</span>], <span style=color:#555>&amp;</span>hints, <span style=color:#555>&amp;</span>peer) <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>)
    {

        printf(<span style=color:#c30>&#34;addrinfo() error!</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>1</span>;
    }

</code></pre></div><ol><li>we start by declaring a <code>addrinfo</code> struct <code>hints</code>. we then call <code>getaddrinfo()</code>. <code>getaddrinfo()</code> resolves domain name into IP address.</li><li>note that unlike in server, we only need to set <code>hints.ai_socktype = SOCK_STREAM;</code> other fields are filled automatically by <code>getaddrinfo()</code> based on IP we are connecting to.</li></ol><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#078;font-weight:700>char</span> peer_addr[<span style=color:#f60>100</span>];
    <span style=color:#078;font-weight:700>char</span> peer_protocol[<span style=color:#f60>100</span>];
    getnameinfo(peer<span style=color:#555>-&gt;</span>ai_addr, peer<span style=color:#555>-&gt;</span>ai_addrlen, peer_addr, <span style=color:#069;font-weight:700>sizeof</span>(peer_addr), peer_protocol, <span style=color:#069;font-weight:700>sizeof</span>(peer_protocol), NI_NUMERICHOST);

    printf(<span style=color:#c30>&#34;ip: %s | protocol: %s</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>, peer_addr, peer_protocol);

</code></pre></div><ol start=0><li>we can print the domain and protocol using the code above (Optional)</li></ol><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#09f;font-style:italic>//family socket_type protocol
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#078;font-weight:700>int</span> socket_fd <span style=color:#555>=</span> socket(peer<span style=color:#555>-&gt;</span>ai_family, peer<span style=color:#555>-&gt;</span>ai_socktype, peer<span style=color:#555>-&gt;</span>ai_protocol);

    <span style=color:#069;font-weight:700>if</span> (socket_fd <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>)
    {
        printf(<span style=color:#c30>&#34;socket error.</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>1</span>;
    }

    <span style=color:#069;font-weight:700>if</span> (connect(socket_fd, peer<span style=color:#555>-&gt;</span>ai_addr, peer<span style=color:#555>-&gt;</span>ai_addrlen) <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>)
    {
        printf(<span style=color:#c30>&#34;connect error.</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
        <span style=color:#069;font-weight:700>return</span> <span style=color:#f60>1</span>;
    }

    printf(<span style=color:#c30>&#34;connected!</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>);
</code></pre></div><ol><li>we start by creating a socket using <code>peer</code> fields are arguments.</li><li>we then need to call <code>connect()</code> to connect to a remote address.<code>connect()</code> returns a negative number on error.</li></ol><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    <span style=color:#078;font-weight:700>char</span> <span style=color:#555>*</span>header <span style=color:#555>=</span> <span style=color:#c30>&#34;GET /index.html HTTP/1.1</span><span style=color:#c30;font-weight:700>\r\n</span><span style=color:#c30>Host: www.example.com</span><span style=color:#c30;font-weight:700>\r\n\r\n</span><span style=color:#c30>&#34;</span>;
    send(socket_fd, header, strlen(header), <span style=color:#f60>0</span>);

    <span style=color:#078;font-weight:700>char</span> res[<span style=color:#f60>4096</span>];
    <span style=color:#078;font-weight:700>int</span> bytes_received <span style=color:#555>=</span> recv(socket_fd, res, <span style=color:#f60>4096</span>, <span style=color:#f60>0</span>);
    printf(<span style=color:#c30>&#34;bytes_received: %d</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>, bytes_received);

    printf(<span style=color:#c30>&#34;%s</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#34;</span>, res);

    close(socket_fd);
</code></pre></div><ol><li>declare a string <strong>header</strong>, this needs to be sent to the server to get a response.</li><li>we can then call <code>recv()</code>, this stores response from the web server into <code>res</code></li><li>the response is printed to <code>stdout</code> using <code>printf()</code></li></ol><h1 id=lets-test-it-out>Let&rsquo;s test it out!</h1><p>compile the program using <code>gcc</code></p><p><code>gcc tcp_client_classic.c -o tcp_client</code></p><p>run the program with required args: <code>domain</code> and <code>protocol</code></p><p><code>./tcp_client example.com http</code></p><p>Output:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>
args: example.com http
ip: 93.184.216.34 | protocol: http
connected!
bytes_received: 1607
HTTP/1.1 200 OK
Accept-Ranges: bytes
Age: 505529
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Wed, 02 Sep 2020 08:30:19 GMT
Etag: &#34;3147526947&#34;
Expires: Wed, 09 Sep 2020 08:30:19 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECS (nyb/1D10)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256

<span style=color:#099>&lt;!doctype html&gt;</span>
&lt;<span style=color:#309;font-weight:700>html</span>&gt;
&lt;<span style=color:#309;font-weight:700>head</span>&gt;
    &lt;<span style=color:#309;font-weight:700>title</span>&gt;Example Domain&lt;/<span style=color:#309;font-weight:700>title</span>&gt;

    &lt;<span style=color:#309;font-weight:700>meta</span> <span style=color:#309>charset</span><span style=color:#555>=</span><span style=color:#c30>&#34;utf-8&#34;</span> /&gt;
    &lt;<span style=color:#309;font-weight:700>meta</span> <span style=color:#309>http-equiv</span><span style=color:#555>=</span><span style=color:#c30>&#34;Content-type&#34;</span> <span style=color:#309>content</span><span style=color:#555>=</span><span style=color:#c30>&#34;text/html; charset=utf-8&#34;</span> /&gt;
    &lt;<span style=color:#309;font-weight:700>meta</span> <span style=color:#309>name</span><span style=color:#555>=</span><span style=color:#c30>&#34;viewport&#34;</span> <span style=color:#309>content</span><span style=color:#555>=</span><span style=color:#c30>&#34;width=device-width, initial-scale=1&#34;</span> /&gt;
    &lt;<span style=color:#309;font-weight:700>style</span> <span style=color:#309>type</span><span style=color:#555>=</span><span style=color:#c30>&#34;text/css&#34;</span>&gt;
    <span style=color:#309;font-weight:700>body</span> {
        <span style=color:#069;font-weight:700>background-color</span>: <span style=color:#f60>#f0f0f2</span>;
        <span style=color:#069;font-weight:700>margin</span>: <span style=color:#f60>0</span>;
        <span style=color:#069;font-weight:700>padding</span>: <span style=color:#f60>0</span>;
        <span style=color:#069;font-weight:700>font-family</span>: <span style=color:#555>-</span>apple-system, system-ui, BlinkMacSystemFont, <span style=color:#c30>&#34;Segoe UI&#34;</span>, <span style=color:#c30>&#34;Open Sans&#34;</span>, <span style=color:#c30>&#34;Helvetica Neue&#34;</span>, Helvetica, Arial, <span style=color:#069;font-weight:700>sans-serif</span>;
        
    }
    <span style=color:#309;font-weight:700>div</span> {
        <span style=color:#069;font-weight:700>width</span>: <span style=color:#f60>600</span><span style=color:#078;font-weight:700>px</span>;
        <span style=color:#069;font-weight:700>margin</span>: <span style=color:#f60>5</span><span style=color:#078;font-weight:700>em</span> <span style=color:#069;font-weight:700>auto</span>;
        <span style=color:#069;font-weight:700>padding</span>: <span style=color:#f60>2</span><span style=color:#078;font-weight:700>em</span>;
        <span style=color:#069;font-weight:700>background-color</span>: <span style=color:#f60>#fdfdff</span>;
        <span style=color:#069;font-weight:700>border-radius</span>: <span style=color:#f60>0.5</span><span style=color:#078;font-weight:700>em</span>;
        <span style=color:#069;font-weight:700>box-shadow</span>: <span style=color:#f60>2</span><span style=color:#078;font-weight:700>px</span> <span style=color:#f60>3</span><span style=color:#078;font-weight:700>px</span> <span style=color:#f60>7</span><span style=color:#078;font-weight:700>px</span> <span style=color:#f60>2</span><span style=color:#078;font-weight:700>px</span> <span style=color:#366>rgba</span>(<span style=color:#f60>0</span>,<span style=color:#f60>0</span>,<span style=color:#f60>0</span>,<span style=color:#f60>0.02</span>);
    }
    <span style=color:#309;font-weight:700>a</span>:<span style=color:#99f>link</span><span style=color:#555>,</span> <span style=color:#309;font-weight:700>a</span>:<span style=color:#99f>visited</span> {
        <span style=color:#069;font-weight:700>color</span>: <span style=color:#f60>#38488f</span>;
        <span style=color:#069;font-weight:700>text-decoration</span>: <span style=color:#069;font-weight:700>none</span>;
    }
    @<span style=color:#069;font-weight:700>media</span> <span style=color:#555>(</span><span style=color:#309;font-weight:700>max-width</span><span style=color:#555>:</span> <span style=color:#309;font-weight:700>700px</span><span style=color:#555>)</span> {
        <span style=color:#309;font-weight:700>div</span> {
            <span style=color:#069;font-weight:700>margin</span>: <span style=color:#f60>0</span> <span style=color:#069;font-weight:700>auto</span>;
            <span style=color:#069;font-weight:700>width</span>: <span style=color:#069;font-weight:700>auto</span>;
        }
    }
    &lt;/<span style=color:#309;font-weight:700>style</span>&gt;    
&lt;/<span style=color:#309;font-weight:700>head</span>&gt;

&lt;<span style=color:#309;font-weight:700>body</span>&gt;
&lt;<span style=color:#309;font-weight:700>div</span>&gt;
    &lt;<span style=color:#309;font-weight:700>h1</span>&gt;Example Domain&lt;/<span style=color:#309;font-weight:700>h1</span>&gt;
    &lt;<span style=color:#309;font-weight:700>p</span>&gt;This domain is for use in illustrative examples in documents. You may use this
    domain in literature without prior coordination or asking for permission.&lt;/<span style=color:#309;font-weight:700>p</span>&gt;
    &lt;<span style=color:#309;font-weight:700>p</span>&gt;&lt;<span style=color:#309;font-weight:700>a</span> <span style=color:#309>href</span><span style=color:#555>=</span><span style=color:#c30>&#34;https://www.iana.org/domains/example&#34;</span>&gt;More information...&lt;/<span style=color:#309;font-weight:700>a</span>&gt;&lt;/<span style=color:#309;font-weight:700>p</span>&gt;
&lt;/<span style=color:#309;font-weight:700>div</span>&gt;
&lt;/<span style=color:#309;font-weight:700>body</span>&gt;
&lt;/<span style=color:#309;font-weight:700>html</span>&gt;

</code></pre></div><h1 id=conclusion>Conclusion</h1><p>This article covered a code walkthrough on how to retrieve a web page using sockets.</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/network-programming>network programming</a></li><li><a href=/tags/c>c</a></li></ul></nav></div><div id=commento></div><script id=comments src=https://utteranc.es/client.js repo=jkotra/stdin.top-comments issue-term=pathname label=ðŸ’¬ theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the
<a href=https://commento.io/>comments powered by Commento.</a></noscript></div><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js></script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/contrib/auto-render.min.js onload=renderMathInElement(document.body);></script></div></div><div class="footer wrapper"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8658473214995139 data-ad-slot=2398602558 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><br><nav class=nav><div class=badge><a href=https://creativecommons.org/licenses/by-sa/4.0/><img src=/cc/by-sa.png></a></div><div><a href=https://gitlab.com/synk.0x1/kavi-hugo-theme>Kavi</a> (based on <a href=https://github.com/vividvilla/ezhil>ezhil</a>)</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>